<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>IPv4 查询 | GoToolOnline</title>
<meta name="description" content="只显示 IPv4（点分十进制）的公网 IP，另附实验性内网 IP（192.168/10/172.*）探测。"/>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><text x='6' y='52' font-size='48'>🛠️</text></svg>"/>
<style>
:root{--bg:#0a0f1e;--card:#0f1830;--muted:#9fb0c3;--fg:#eaf3ff;--acc:#4fb3ff}
*{box-sizing:border-box}
body{margin:0;font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,"PingFang SC","Microsoft YaHei",sans-serif;background:var(--bg);color:var(--fg)}
main,header,footer{max-width:880px;margin:0 auto;padding:0 18px}
header{display:flex;gap:12px;align-items:center;margin:22px auto 8px}
header .logo{display:flex;gap:10px;align-items:center;text-decoration:none;color:var(--fg);font-weight:800;font-size:22px}
.card{background:var(--card);border:1px solid #1a2843;border-radius:18px;padding:18px;margin:16px 0}
h1{margin:6px 0 8px;font-size:28px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
button{padding:12px 14px;border-radius:12px;border:1px solid #24365b;background:linear-gradient(180deg,#2a78ff,#0050d4);color:#fff;font-weight:700;cursor:pointer}
button.secondary{background:#0f1a2f;color:#eaf3ff}
button:hover{filter:brightness(1.06)}
.result{margin-top:12px;padding:14px;background:#0c1426;border:1px dashed #2a3c64;border-radius:12px;font-size:20px;display:flex;justify-content:space-between;align-items:center;gap:10px}
.small{font-size:14px;color:var(--muted)}
.code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,"Cascadia Mono","Segoe UI Mono",Consolas,"Liberation Mono",monospace}
.copy{margin-left:auto;background:#0f1a2f;border:1px solid #24365b}
.tip{margin-top:8px}
footer{color:var(--muted);font-size:14px;margin:36px auto 28px}
@media (max-width:720px){ .result{flex-direction:column;align-items:flex-start} .copy{margin-left:0} }
</style>
</head>
<body>
<header>
  <a class="logo" href="./"><span>🛠️</span><strong>GoToolOnline</strong></a>
</header>
<main>
  <section class="card">
    <h1>IPv4 查询（只显示点分十进制）</h1>
    <div class="row">
      <button id="btnV4">获取我的 IPv4</button>
      <button id="btnCopy" class="copy">复制</button>
      <button id="btnLan" class="secondary">尝试获取内网 IPv4（实验）</button>
    </div>
    <div class="result">
      <span><span>你的 IPv4：</span> <strong id="ip" class="code">—</strong></span>
      <span class="small" id="copied" style="display:none">已复制！</span>
    </div>
    <p class="small tip" id="note">说明：这里显示的是公网 IPv4（点分十进制）。如果你的网络没有分配公网 IPv4，只会得到 IPv6 或失败。</p>
    <div class="card" style="margin-top:14px">
      <div class="small">内网 IP（如 192.168.x.x / 10.x.x.x / 172.16–31.x.x）受浏览器隐私保护，通常拿不到。下面按钮用 WebRTC 试探，成功率不保证。</div>
      <div class="result" style="margin-top:10px">
        <span><span>内网 IPv4（实验）：</span> <strong id="lan" class="code">—</strong></span>
      </div>
    </div>
  </section>
</main>
<footer>© 2025 GoToolOnline.com</footer>

<script>
// 简单 IPv4 验证
const IPV4_RE=/^(?:(?:25[0-5]|2[0-4]\\d|1?\\d?\\d)\\.){3}(?:25[0-5]|2[0-4]\\d|1?\\d?\\d)$/;
const $=s=>document.querySelector(s);

function showCopied(){
  const el=$('#copied'); el.style.display=''; setTimeout(()=>el.style.display='none',1200);
}

function setText(id, txt){ const el=document.getElementById(id); if(el) el.textContent=txt; }

async function fetchIPv4(){
  setText('ip','查询中…');
  try{
    const ctrl=new AbortController();
    const t=setTimeout(()=>ctrl.abort(), 5000);
    const r=await fetch('https://api4.ipify.org?format=json', {signal:ctrl.signal, cache:'no-store'});
    clearTimeout(t);
    if(!r.ok) throw new Error('http '+r.status);
    const d=await r.json();
    const ip=String(d.ip||'');
    if(IPV4_RE.test(ip)){ setText('ip', ip); }
    else { setText('ip', '未获取到公网 IPv4'); }
  }catch(e){
    setText('ip','未获取到公网 IPv4');
  }
}

function copyIPv4(){
  const v=($('#ip').textContent||'').trim();
  if(!IPV4_RE.test(v)) return;
  navigator.clipboard?.writeText(v).then(showCopied).catch(()=>{});
}

// —— 实验：尝试获取内网 IPv4 ——
// 说明：现代浏览器可能只返回 mDNS host（xxxx.local），或干脆不暴露；因此成功率不保证。
async function detectLAN(){
  setText('lan','尝试中…');
  try{
    const pc=new RTCPeerConnection({iceServers:[]}); // 本地候选即可
    pc.createDataChannel('x');
    const found=new Set();
    const stop=()=>{ try{pc.close();}catch(e){} };
    const timer=setTimeout(()=>{ stop(); if($('#lan').textContent==='尝试中…') setText('lan','未获取到（浏览器已屏蔽）'); }, 7000);

    pc.onicecandidate=(e)=>{
      if(!e.candidate){ return; }
      const c=e.candidate.candidate||'';
      // 仅 host 候选
      if(!/ typ host\\b/.test(c)) return;
      // 抓 IPv4
      const m=c.match(/(\\d{1,3}(?:\\.\\d{1,3}){3})/);
      if(!m) return;
      const ip=m[1];
      if(!IPV4_RE.test(ip)) return;
      // 只收 RFC1918 私网
      if(/^10\\./.test(ip) || /^192\\.168\\./.test(ip) || /^172\\.(1[6-9]|2\\d|3[0-1])\\./.test(ip)){
        if(!found.has(ip)){
          found.add(ip);
          setText('lan', ip);
          clearTimeout(timer);
          stop();
        }
      }
    };
    const sdp=await pc.createOffer({offerToReceiveAudio:false,offerToReceiveVideo:false});
    await pc.setLocalDescription(sdp);
  }catch(e){
    setText('lan','未获取到（浏览器已屏蔽）');
  }
}

document.getElementById('btnV4').addEventListener('click', fetchIPv4);
document.getElementById('btnCopy').addEventListener('click', copyIPv4);
document.getElementById('btnLan').addEventListener('click', detectLAN);

// 首次自动拉取公网 IPv4
fetchIPv4();
</script>
</body>
</html>
